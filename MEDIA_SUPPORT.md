# –§–∏—á–∏ –º–µ–¥–∏–∞ –≤ –¥–∏–∞–ª–æ–≥–µ

## –û–±—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ù—ã–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ **–Ω–æ–≤—ã–µ** —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `send_message()`, `send_photo()`, `send_voice()`, `send_sticker()` –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ª—é–±—ã–µ —Ü–∏–∫–ª—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–¥–∏–∞

#### üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
```python
if message.photo:
    await bot.send_photo(partner_id, message.photo[-1].file_id, caption=message.caption or "üì∑")
```

#### üéû –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```python
if message.voice:
    await bot.send_voice(partner_id, message.voice.file_id)
```

#### üëΩ –°—Ç–∏–∫–µ—Ä—ã
```python
if message.sticker:
    await bot.send_sticker(partner_id, message.sticker.file_id)
```

#### üí¨ –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```python
if message.text:
    await bot.send_message(partner_id, message.text)
```

## –§–∏–ª—ã—Ç—Ä—ã –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –£—Å–ª–æ–≤–∏—è –¥–ª—è `handle_chat_message`:

```python
dp.message.register(
    handle_chat_message,
    StateFilter(UserStates.in_chat),
    F.text | F.photo | F.voice | F.sticker  # –õ—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö —Ç–∏–ø–æ–≤
)
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

### –û—Ç–æ—Å–ª–∞–Ω–∏–µ –ü–∞—Ä—Ç–Ω—ë—Ä–∞
–ï—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –≤—ã—à–µ–ª –∏–∑ —á–∞—Ç–∞, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –≤ –æ—Ü–µ–Ω—á–∏–∫–µ:

```
‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. 
–í–æ–∑–º–æ–∂–Ω–æ, —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –≤—ã—à–µ–ª –∏–∑ —á–∞—Ç–∞.
```

### –û—á–∏—Å—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
–ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è:
- `active_chats[user_id]`
- `active_chats[partner_id]`

## –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `messages`:

```sql
INSERT INTO messages (chat_id, sender_id, content)
VALUES (?, ?, ?)
```

#### –ù–∞–ø—Ä–∏–º–µ—Ä—ã:
- `–¢–µ–∫—Å—Ç` - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
- `[üì∑ –§–æ—Ç–æ]` - —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Ñ–æ—Ç–æ
- `[üéû –ì–æ–ª–æ—Å]` - —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞
- `[üëΩ –°—Ç–∏–∫–µ—Ä]` - —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞

## –§–∏–ª—ã –¥—Ö –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

- **bot/main.py** - –≥–ª–∞–≤–Ω–æ–π —ç–Ω—Ç—Ä–∏–ø–æ–π–Ω—Ç —Å –≤—Å–µ–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
- **bot/handlers.py** - —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∏–µ –±–æ—Ç–∞
sudo systemctl restart bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo tail -f /home/bot/logs/bot.log
```

## –ü—Ä–∏–º–µ—Ä –û—Ç–ø—Ä–∞–≤–∫–∏

### –Ø–≤–Ω–æ –≥–≤—ã –¥–∏–∞–ª–æ–≥–µ:

1. **–ù–∞—Ä–æ–¥–±**
   - /search - —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –û–±–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—â –≤ —á–∞—Ç–µ —Ä–∞–±–æ—Ç–∞—é—Ç

2. **–û—Å–Ω–æ–≤–Ω–æ–µ**
   - –û–ø–æ–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞
   - –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏

## –ï—Å–ª–∏ –ù—É–∂–Ω–æ –û—Ç–∫–ª—é—á–∏—Ç—å –û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ú–µ–¥–∏–∞

–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤ `handle_chat_message`:

```python
# –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–∏–¥–µ–æ
# elif message.video:
#     return
```
